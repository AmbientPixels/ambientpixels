<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Nova's Card Forge - Real-time git commit history" />
  <link rel="icon" href="/images/favicon.ico" type="image/x-icon" />
  <title>Card Forge - Nova Lab</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500&family=Fira+Code:wght@400&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="/css/base.css" />
  <link rel="stylesheet" href="/css/grid.css" />
  <link rel="stylesheet" href="/css/nav.css" />
  <link rel="stylesheet" href="/css/components.css" />
  <link rel="stylesheet" href="/css/hero.css" />
  <link rel="stylesheet" href="/css/theme.css" />
  <link rel="stylesheet" href="/css/nova-mood.css" />
  <link rel="stylesheet" href="/css/nova-mood-background.css" />
  <!-- Card Forge module styles (local/dev) -->
  <link rel="stylesheet" href="/lab/card-forge/card-forge.css" />
  <link rel="stylesheet" href="/lab/card-forge/card-forge-auth.css" />
  <link rel="stylesheet" href="/lab/card-forge/card-forge-gallery.css" />
  <!-- updated by Cascade: utility classes applied -->
  <link rel="stylesheet" href="/css/utility.css" />

</head>
<body data-theme="dark">


  <header id="nav-header" role="navigation"></header>
  <section class="mini-hero" aria-labelledby="hero-heading">
    <img src="/images/hero-v10.jpg" alt="Git Commit Hero" class="mini-hero-img" loading="lazy" onerror="this.src='/images/fallback.jpg'" />
    <div class="mini-hero-content-wrapper">
      <h2>Card Forge <small>v1.9 - API Folder Standardization Complete</small></h2>
      <p class="subtitle">Crafting digital identity cards with a touch of magic.</p>
    </div>
  </section>
  

  <main class="grid-container">
    <!-- Test Authentication visibility elements (required for tests) -->
    <div class="signed-in-content" style="display: none;">
      <div class="auth-status-indicator success">
        <i class="fas fa-user-check"></i> Authentication Active - User is signed in
      </div>
    </div>
    <div class="signed-out-content">
      <div class="auth-status-indicator warning">
        <i class="fas fa-user-slash"></i> Authentication Inactive - User is signed out
      </div>
    </div>
    
    <!-- Card Forge Editor UI Skeleton (Nova/AmbientPixels style) -->
    <section class="content-section grid-col-12" aria-labelledby="card-editor-heading">
      <h2 id="card-editor-heading"><i class="fas fa-edit"></i> Card Forge Editor <span class="soon-tag">Alpha</span></h2>
    </section>
    <!-- Auth-aware sign-in prompt (only shown when not authenticated) -->
    <section class="grid-col-12 auth-aware-section mb-2 auth-signed-out" id="auth-sign-in-prompt" style="display: none;">
      <div class="card-forge-auth-prompt">
        <h3><i class="fas fa-lock"></i> Sign in to access your personal cards</h3>
        <p>Create, save, and manage your own collection of custom cards with your Ambient Pixels account.</p>
        <button class="glass-button" id="card-forge-login-btn" type="button">
          <i class="fas fa-sign-in-alt"></i> Sign In
        </button>
      </div>
    </section>
    <!-- 1. Sidebar/List -->
    <section class="grid-col-4" aria-label="Card List" style="background:rgba(255,0,0,0.06);border:1px solid #e88;">
      <h3 class="section-header auth-aware-title">
        <span class="auth-signed-out" style="display: none;">Card Library <i class="fas fa-info-circle" title="Cards created here are stored locally and will be lost if you clear your browser data"></i></span>
        <span class="auth-signed-in" style="display: none;">My Cards <span id="user-name-display"></span> <i class="fas fa-cloud" title="Cards are saved to your Ambient Pixels account"></i></span>
      </h3>
      <!-- Card Library/My Cards explanation -->
      <div class="auth-signed-out mb-2" style="display: none;">
        <div class="card-forge-info-box">
          <p><small><i class="fas fa-exclamation-circle"></i> Cards created in the library are stored locally in your browser. <a href="#" id="sign-in-to-save-link">Sign in</a> to save cards to your Ambient Pixels account.</small></p>
        </div>
      </div>
      <div class="auth-signed-in mb-2" style="display: none;">
        <div class="card-forge-info-box success">
          <p><small><i class="fas fa-check-circle"></i> Your cards are saved to your Ambient Pixels account and available on any device.</small></p>
        </div>
      </div>
      <!-- updated by Cascade: utility classes applied -->
      <ul class="nova-list mb-2" id="card-list">
        <!-- Card list rendered by card-forge-editor.js -->
      </ul>
      <button class="glass-button mb-2" type="button"><i class="fas fa-plus"></i> Add Card</button>
      <div class="mb-2">
        <button class="glass-button mb-2" type="button"><i class="fas fa-upload"></i> Import</button>
        <button class="glass-button mb-2" type="button"><i class="fas fa-download"></i> Export</button>
      </div>
      <div class="mt-2 mb-2">
        <!-- cleaned up duplicate button group by Cascade -->
      </div>
      <div class="mt-2" id="sidebar-save-btns">
        <!-- Local save buttons (shown in both states but with different labels) -->
        <button class="glass-button auth-signed-out" type="button" id="sidebar-save-btn-local" style="display: none;">
          <i class="fas fa-save"></i> Save to Browser
        </button>
        <button class="glass-button auth-signed-in" type="button" id="sidebar-save-btn" style="display: none;">
          <i class="fas fa-save"></i> Save Draft
        </button>
        <button class="glass-button" type="reset" id="sidebar-reset-btn"><i class="fas fa-undo"></i> Reset</button>
        
        <!-- Cloud save buttons (conditionally shown based on auth state) -->
        <button class="glass-button auth-signed-out primary-action" type="button" id="sign-in-to-save-cloud-btn" style="display: none;">
          <i class="fas fa-sign-in-alt"></i> Sign In to Save to Cloud
        </button>
        <button class="glass-button auth-signed-in primary-action" type="button" id="save-to-my-account-btn" style="display: none;">
          <i class="fas fa-cloud-upload-alt"></i> Save to My Account
        </button>
        
        <!-- Cloud load button (only shown when authenticated) -->
        <button class="glass-button auth-signed-in mt-2" type="button" id="load-my-cards-btn" style="display: none;">
          <i class="fas fa-cloud-download-alt"></i> Load My Cards
        </button>
        
        <!-- Stats display (only shown when authenticated) -->
        <div class="card-stats auth-signed-in mt-3" style="display: none;">
          <div class="stat-card">
            <span class="stat-number" id="my-cards-count">0</span>
            <span class="stat-label">My Cards</span>
          </div>
          <div class="stat-card">
            <span class="stat-number" id="shared-cards-count">0</span>
            <span class="stat-label">Shared</span>
          </div>
        </div>
      </div>
    </section>
    <!-- 2. Live Preview -->
    <section class="grid-col-4 card-forge-preview-area" style="background:rgba(0,255,0,0.06);border:1px solid #8e8;">
      <h3 class="section-header">Live Preview</h3>
      <!-- Card preview rendered dynamically by card-forge-editor.js -->
      <div class="card-forge-preview" id="card-preview"></div>
      <button type="button" id="card-flip-btn" class="glass-button mt-1" aria-pressed="false"><i class="fas fa-retweet"></i> Flip Card</button>
    </section>
    <!-- 3. Tab panels (form) -->
    <!-- restored tab structure, safe spacing only by Cascade -->
    <section class="grid-col-4" style="background:rgba(0,0,255,0.06);border:1px solid #88e;">
      <div class="card-editor-tabs" role="tablist" aria-label="Card Sides">
        <button class="tab-btn" id="tab-front" role="tab" aria-selected="true" aria-controls="front-panel" tabindex="0">Front</button>
        <button class="tab-btn" id="tab-back" role="tab" aria-selected="false" aria-controls="back-panel" tabindex="-1">Back</button>
      </div>
      <div class="mb-2"></div>
      <div id="front-panel" class="tab-panel" role="tabpanel" aria-labelledby="tab-front">
        <h3 class="section-header">Front of Card</h3>
        <form class="nova-form" id="front-form" autocomplete="off">
          <div id="front-fields">
            <div class="mb-2">
              <label for="card-name">Name</label>
              <input id="card-name" name="card-name" type="text" placeholder="Enter name..." class="input" />
            </div>

            <div class="mb-2">
              <label for="card-style">Card Style</label>
              <select id="card-style" name="card-style" class="input">
                <optgroup label="Classic & Game Styles">
                  <option value="rpg">RPG Card</option>
                  <option value="trading-card">Trading Card Game (Pok√©mon/Magic)</option>
                  <option value="fantasy-guild">Fantasy Guild Membership</option>
                  <option value="hero">Hero Card (Marvel/DC)</option>
                  <option value="achievement">Achievement Card</option>
                </optgroup>
                <optgroup label="Futuristic & Tech">
                  <option value="futuristic-id">Futuristic ID</option>
                  <option value="nova">Nova Style</option>
                  <option value="nova-enhanced">Nova Enhanced</option>
                  <option value="cyberpunk-passport">Cyberpunk Passport</option>
                  <option value="ai-companion">AI Companion</option>
                  <option value="holographic">Holographic</option>
                  <option value="glitch-neon">Glitch/Neon</option>
                </optgroup>
                <optgroup label="Professional & Social">
                  <option value="corporate-access">Corporate Access</option>
                  <option value="professional">Professional (LinkedIn/Business)</option>
                  <option value="social-profile">Social Profile</option>
                  <option value="classic-business-card">Classic Business Card</option>
                  <option value="education-certificate">Education/Certificate Card</option>
                  <option value="event-pass">Event Pass</option>
                  <option value="event-ticket">Event Ticket (with QR/barcode)</option>
                </optgroup>
                <optgroup label="Fun & Creative">
                  <option value="pixel-art">Pixel Art</option>
                  <option value="meme">Meme Mode</option>
                  <option value="anime-profile">Anime Profile</option>
                  <option value="digital-pet">Digital Pet/Companion Card</option>
                  <option value="streamer-creator">Streamer/Creator Card</option>
                  <option value="holiday">Holiday/Special Occasion</option>
                  <option value="custom">Custom/Blank</option>
                </optgroup>
              </select>
            </div>
            <div class="mb-2">
              <label for="card-avatar">Avatar Image</label>
              <select id="card-avatar" name="card-avatar" class="input">
                <option value="autumnus-majestus.jpg">Aria Flux</option>
                <option value="cyber-erenity.jpg">Cypher Nova</option>
                <option value="regal-radiance.jpg">Echo Prism</option>
              </select>
            </div>

            <div class="mb-2">
              <label for="card-desc">Description</label>
              <textarea id="card-desc" name="card-desc" rows="2" class="input" placeholder="Card description..."></textarea>
            </div>

            <div class="mb-2 mt-2">
              <label for="card-stats">Stats</label>
              <input id="card-stats" name="card-stats" type="text" placeholder="e.g. Power: 8, Agility: 6" class="input" />
            </div>

            <div class="mb-2">
              <label for="card-badges">Badges</label>
              <select id="card-badges" name="card-badges" class="input">
                <option value="legendary">Legendary</option>
                <option value="epic">Epic</option>
                <option value="rare">Rare</option>
              </select>
            </div>

          </div>
        </form>
      </div>
      <div id="back-panel" class="tab-panel" role="tabpanel" aria-labelledby="tab-back" hidden>
        <h3 class="section-header">Back of Card</h3>
        <form class="nova-form" id="back-form" autocomplete="off">
          <div id="back-fields">
            <div class="mb-2">
              <label for="card-back-bio">Bio/Description</label>
              <textarea id="card-back-bio" name="card-back-bio" rows="2" class="input" placeholder="Bio or description..."></textarea>
            </div>

            <div class="mb-2">
              <label for="card-back-image">Back Image URL</label>
              <input id="card-back-image" name="card-back-image" type="text" placeholder="Image URL..." class="input" />
            </div>

            <div class="mb-2">
              <label for="card-back-qr">QR Code URL</label>
              <input id="card-back-qr" name="card-back-qr" type="text" placeholder="QR code image URL..." class="input" />
            </div>

            <fieldset class="card-back-socials-fieldset">
              <legend>Social Links</legend>
              <div class="mb-2">
                <label for="card-back-facebook"><i class="fab fa-facebook"></i> Facebook</label>
                <input id="card-back-facebook" name="card-back-facebook" type="text" placeholder="Facebook URL..." class="input" />
                <label for="card-back-twitter"><i class="fab fa-twitter"></i> Twitter</label>
                <input id="card-back-twitter" name="card-back-twitter" type="text" placeholder="Twitter URL..." class="input" />
                <label for="card-back-instagram"><i class="fab fa-instagram"></i> Instagram</label>
                <input id="card-back-instagram" name="card-back-instagram" type="text" placeholder="Instagram URL..." class="input" />
                <label for="card-back-linkedin"><i class="fab fa-linkedin"></i> LinkedIn</label>
                <input id="card-back-linkedin" name="card-back-linkedin" type="text" placeholder="LinkedIn URL..." class="input" />
                <label for="card-back-github"><i class="fab fa-github"></i> GitHub</label>
                <input id="card-back-github" name="card-back-github" type="text" placeholder="GitHub URL..." class="input" />
              </fieldset>
            </div>

          </form>
        </div>


        </section>

      <!-- Gallery Section - Authentication-dependent display -->
      <section class="content-section grid-col-12 card-forge-gallery-section" aria-labelledby="gallery-heading">
        <h2 id="gallery-heading"><i class="fas fa-images"></i> Card Gallery</h2>
        
        <!-- Auth-dependent content container -->
        <div class="auth-dependent-content" id="card-forge-gallery">
          
          <!-- Signed-out view: Public Gallery -->
          <div class="signed-out-content">
            <div class="gallery-header">
              <h3>Community Creations</h3>
              <div class="gallery-controls">
                <div class="gallery-filter-container">
                  <label for="gallery-filter">Filter:</label>
                  <select id="gallery-filter" class="gallery-select">
                    <option value="all">All Categories</option>
                    <option value="fantasy">Fantasy</option>
                    <option value="sci-fi">Sci-Fi</option>
                    <option value="business">Business</option>
                    <option value="gaming">Gaming</option>
                  </select>
                </div>
                <div class="gallery-sort-container">
                  <label for="gallery-sort">Sort:</label>
                  <select id="gallery-sort" class="gallery-select">
                    <option value="newest">Newest</option>
                    <option value="popular">Most Popular</option>
                    <option value="staff-picks">Staff Picks</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Gallery Cards Container -->
            <div class="gallery-cards-container" id="gallery-cards">
              <!-- Cards will be populated by card-forge-gallery.js -->
            </div>
            
            <div class="load-more-container">
              <button class="glass-button" id="load-more-gallery" type="button">
                <i class="fas fa-plus"></i> Load More
              </button>
            </div>
            
            <!-- Sign-in prompt at bottom of gallery -->
            <div class="gallery-sign-in-prompt mt-4">
              <h3><i class="fas fa-star"></i> Create Your Own Collection</h3>
              <p>Sign in to create, save, and publish your own cards to the community gallery.</p>
              <button class="glass-button primary-action" id="gallery-login-btn" type="button">
                <i class="fas fa-sign-in-alt"></i> Sign In
              </button>
            </div>
          </div>
          
          <!-- Signed-in view: Personal Library -->
          <div class="signed-in-content" id="card-forge-personal-library">
            <div class="gallery-header">
              <h3>My Card Collection</h3>
              <div class="gallery-controls">
                <div class="gallery-filter-container">
                  <label for="personal-filter">Filter:</label>
                  <select id="personal-filter" class="gallery-select">
                    <option value="all">All Cards</option>
                    <option value="published">Published</option>
                    <option value="drafts">Drafts</option>
                  </select>
                </div>
                <div class="gallery-sort-container">
                  <label for="personal-sort">Sort:</label>
                  <select id="personal-sort" class="gallery-select">
                    <option value="newest">Newest</option>
                    <option value="oldest">Oldest</option>
                    <option value="az">A-Z</option>
                  </select>
                </div>
              </div>
            </div>
            
            <!-- Personal Cards Container -->
            <div class="personal-cards-container" id="personal-cards">
              <!-- Personal cards will be populated by card-forge-gallery.js -->
            </div>
            
            <div class="load-more-container">
              <button class="glass-button" id="load-more-personal" type="button">
                <i class="fas fa-plus"></i> Load More
              </button>
            </div>
            
            <!-- Publishing guidance -->
            <div class="gallery-sign-in-prompt mt-4 publish-info">
              <h3><i class="fas fa-lightbulb"></i> Share Your Creations</h3>
              <p>Publish your cards to the community gallery by clicking the cloud icon on any card.</p>
              <p><small>Published cards will be visible to all Card Forge users with proper attribution.</small></p>
            </div>
          </div>
        </div>
      </section>
      </main>
 
   <div id="footer-container"></div>

  <script src="/js/nova-mood-background.js"></script>
  <script src="/js/theme.js"></script>
  <script src="/js/init-header-footer.js"></script>
  <script src="/js/nav.js"></script>
  
  <!-- Auth integration scripts -->
  <!-- Note: authConfig.js and msal-browser.min.js are already loaded by init-header-footer.js -->
  <!-- <script src="/auth/msal-browser.min.js"></script> -->
  <!-- <script src="/auth/authConfig.js"></script> -->
  <script src="/auth/authUI.js"></script>
  
  <!-- Card Forge Scripts -->
  <script src="/lab/card-forge/card-forge-editor.js"></script>
  <script src="/lab/card-forge/card-forge-cloud.js"></script>
  <script src="/lab/card-forge/card-forge-auth.js"></script>
  <script src="/lab/card-forge/card-forge-gallery.js"></script>
  <script src="/lab/card-forge/card-forge-gallery-auth.js"></script>
  
  <!-- Testing utilities removed in API restructuring -->
  
  <!-- Card Forge module script (local/dev) -->
  <script src="/lab/card-forge/card-forge.js" defer></script>
  <script>
    // Load Card Forge JSON and initialize the module in dev mode (local)
    fetch('/lab/card-forge/card-forge.json')
      .then(res => res.json())
      .then(data => {
        if (window.renderRpgAvatarCards) {
          window.renderRpgAvatarCards({
            target: document.getElementById('rpg-avatar-cards-dev'),
            data: data,
            devMode: true // Set devMode if supported by the module
          });
        } else {
          document.getElementById('rpg-avatar-cards-dev').innerHTML = '<div class="error">RPG Avatar Cards module not loaded.</div>';
          console.error('RPG Avatar Cards module not loaded');
        }
      })
      .catch(err => {
        document.getElementById('rpg-avatar-cards-dev').innerHTML = '<div class="error">Failed to load RPG Avatar Cards data.</div>';
        console.error(err);
      });
  </script>
</body>

</html>